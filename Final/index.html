<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>
    Navigation Drawer
  </title>

  <link href="final-style.css" rel="stylesheet" type="text/css" />

  <!-- Material Design 2 -->
  <link href="https://unpkg.com/material-components-web@latest/dist/material-components-web.min.css" rel="stylesheet">
  <script src="https://unpkg.com/material-components-web@latest/dist/material-components-web.min.js">
  </script>
  <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
  <!-- Bootstraps -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.1/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-iYQeCzEYFbKjA/T2uDLTpkwGzCiq6soy8tYaI1GyVh/UjpbCx/TYkiZhlZB6+fzT" crossorigin="anonymous">
  <!-- Google Fonts -->
  <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
  <!--  Dexie Database  -->
  <script src="https://unpkg.com/dexie/dist/dexie.js"></script>
</head>

<body>
  <!--  Top App Bar  -->
  <header class="mdc-top-app-bar app-bar" id="app-bar">
    <div class="mdc-top-app-bar__row">
      <section class="mdc-top-app-bar__section mdc-top-app-bar__section--align-start">
        <button class="material-icons mdc-top-app-bar__navigation-icon mdc-icon-button">menu</button>
        <span class="mdc-top-app-bar__title">Chicago</span>
      </section>
    </div>
  </header>

  <!--  Navigation Drawer  -->
  <aside class="mdc-drawer mdc-drawer--dismissible mdc-top-app-bar--fixed-adjust">
    <div class="mdc-drawer__content">
      <div class="mdc-list">

        <a class="mdc-list-item nav-tab mdc-list-item--activated" href="" data-screen="div1" aria-current="page">
          <span class="mdc-list-item__ripple"></span>
          <span class="mdc-list-item__text" data-screen="div1">Home</span>
        </a>

        <a class="mdc-list-item nav-tab" href="" data-screen="div2">
          <span class="mdc-list-item__ripple"></span>
          <span class="mdc-list-item__text" data-screen="div2">Articles</span>
        </a>

        <a class="mdc-list-item nav-tab" href="" data-screen="div3">
          <span class="mdc-list-item__ripple"></span>
          <span class="mdc-list-item__text" data-screen="div3">PostBoard</span>
        </a>

        <a class="mdc-list-item nav-tab" href="" data-screen="div4">
          <span class="mdc-list-item__ripple"></span>
          <span class="mdc-list-item__text" data-screen="div4">Movies Playing</span>
        </a>

      </div>
    </div>
  </aside>

  <!--  Screens  -->
  <div class="mdc-drawer-app-content mdc-top-app-bar--fixed-adjust">
    <!--   Homepage   -->
    <main id="div1" class="screen main-content" style="display:none;">
      <img class="home-bg" src="images/theBean.jpg">
      <h1 class="home-title">CHICAGO</h1>

      <p class="home-text">To get started, click on the top left icon.</p>

    </main>

    <!--   Article Search   -->
    <main id="div2" class="screen main-content" style="display:none;">
      <center>
        <h1 style="font-family: 'Courier New', Courier, monospace; background-color:lightblue;"><strong>CHECK OUT THE
            NEWS ABOUT CHICAGO</strong></h1>
      </center>
      <div class="article-container"></div>
    </main>

    <!--   PostBoard: What do you think of Chicago?   -->
    <main id="div3" class="screen main-content" style="display:none;">
      <h1 style="font-family: 'Courier New', Courier, monospace; background-color:lightblue; text-align: center;">
        <strong>THOUGHTS ABOUT CHICAGO? WRITE IT DOWN!</strong>
      </h1>

      <!--    A modal window to write review    -->
      <div id="create-note-window">
        <div class="create-note-content">
          <section>
            <center>
              <h1 style="background-color:lightblue; font-family: 'Courier New', Courier, monospace;"><b>WRITE A
                  REVIEW</b></h1>
              <br>
              <h3 style="background-color: lightblue; font-family: 'Courier New', Courier, monospace;"><b>Enter your
                  name</b></h3>
              <input type="text" id="user-name-entry" style="width:70%;" name="user-name-entry">
              <br>
              <br>

              <section style="background-color: lightblue; font-family: 'Courier New', Courier, monospace;">
                <h3><b>Share your thoughts about Chicago</b></h3>
                <h5><b>(It could be about your favorite place, moment, experience, etc.)</b></h5>
              </section>

              <textarea id="user-body-entry" name="user-body-entry" rows="12" cols="150"
                style="resize: none; width:95%"></textarea>
              <br>
              <br>
              <button class="mdc-button mdc-button--raised submit-note-button">
                <span class="mdc-button__label">Submit</span>
              </button>
            </center>
          </section>
        </div>
      </div>


      <div id="post-screen">
        <center>
          <button class="mdc-button mdc-button--unelevated create-note-button">
            <span class="mdc-button__ripple"></span>
            <span class="mdc-button__label" style="">Create a Review</span>
          </button>
        </center>

        <div class="review-list">
          <ul class="mdc-list mdc-list--two-line">
            <!-- This is where all the reviews are stored in -->

          </ul>
        </div>

    </main>

    <!--   Movies Playing   -->
    <main id="div4" class="screen main-content" style="display:none;">
      <center>
        <h1 style="font-family: 'Courier New', Courier, monospace; background-color:lightblue;"><strong>CHECK OUT THE
            MOVIES THAT ARE PLAYING IN CHICAGO RIGHT NOW</strong></h1>
      </center>

      <div id="map">
        <script async
          src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDCkqAP80kb0ma2EkzRND0LnwixmQbqFtA&callback=initMap">
          </script>
      </div>

      <!--   Filter Movies   -->
      <center>
        <br>
        <h2 style="font-family: 'Courier New', Courier, monospace; background-color:lightblue;"><strong>FILTER MOVIE
            LOCATIONS</strong></h2>
      </center>

      <!--   Day Checkbox Options     -->
      <div class="mdc-card mdc-card--outlined">
        <center style="font-size: 25px; font-family: 'Courier New', Courier, monospace;"><b><u>Choose the Day of the
              Week</u></b></center>
        <div class="mdc-form-field movie-day">
        </div>
      </div>

      <!--    Movie Rating Checkbox Options    -->
      <div class="mdc-card mdc-card--outlined">
        <center style="font-size: 25px; font-family: 'Courier New', Courier, monospace;"><b><u>Choose a Movie
              Rating</u></b></center>
        <div class="mdc-form-field movie-rating">
        </div>
      </div>

      <!--    Movie Location DropdownOptions    -->
      <div class="mdc-card mdc-card--outlined">
        <center style="font-size: 25px; font-family: 'Courier New', Courier, monospace;"><b><u>Choose a Movie
              Location</u></b></center>
        <div class="movie-location">
          <!--   Filter for movie locations     -->
        </div>
        <br>
      </div>

      <center>
        <button class="mdc-button mdc-button--raised submit-button" style="width:100%; height:40px">
          <span class="mdc-button__label submit-button">FILTER</span>
        </button>
      </center>

      <br>
      <!--  TODO: Display the results   -->
      <div class="movie-container-filter-results"></div>

      <!--  API call: https://data.cityofchicago.org/Events/Chicago-Park-District-Movies-in-the-Parks-2019/7piw-z6r6   -->

      <script>
        let map;

        function initMap() {
          const chicagoLocation = {lat: 41.8781, lng: -87.623177};

          // When you open the map, it show the Chicago area
          map = new google.maps.Map(document.getElementById("map"), {
            center: chicagoLocation,
            zoom: 12,
          });

          // Add markers to show where the movies are taking place at
          var moviePlaceURL = "https://data.cityofchicago.org/resource/7piw-z6r6.json"

          var output = []; // Store results from filters
          var markers = []; // Store the markers on the map

          // Intitalize map with markers
          //Fetch data based on the filters
          fetch(moviePlaceURL)
            .then((response) => {return response.json()})
            .then((data) => {
              data.forEach((record) => {
                if (record.title != "My Favorite Wife") {
                  output.push(record)
                }
              })

              // Populate the map with markers for the first time
              output.forEach((record) => {
                // Get the location's latitude and longitude
                let locationLat = record.location.latitude;
                let locationLong = record.location.longitude;

                var newLatLong = new google.maps.LatLng(locationLat, locationLong);

                // Create a marker for the location
                var marker = new google.maps.Marker({
                  position: newLatLong,
                  map,
                });

                // Tells information about the location
                let locationContentString = "<h5>" + record.title + "</h5><b><u>Movie Rating:</u></b> " + record.rating + "<br><br><b><u>When:</u></b> " + record.date.substring(0, 10) + "<br><br><b><u>Place:</u></b> " + record.park + "<br><b><u>Address:</u></b> " + record.park_address + "<br><b><u>Phone Number:</u></b> " + record.park_phone;

                // Create the info window, setting the content to the locationContentString
                var infowindow = new google.maps.InfoWindow({
                  content: locationContentString,
                });

                // User clicks on the marker to view content
                marker.addListener("click", (event) => {
                  infowindow.open({
                    anchor: marker,
                    map,
                    shouldFocus: false,
                  });
                })

                // Store the marker
                markers.push(marker)
              })


              // When the user click the filter button, filter the result
              const submitBttn = document.querySelector(".submit-button")

              submitBttn.addEventListener("click", (event) => {
                // Make all the markers hidden
                markers.forEach((marker) => {
                  marker.setMap(null);
                })

                // Remove all the markers
                markers = [];

                // Get all day filters the user clicks on
                let dayCheckBoxes = document.querySelectorAll('input[name="day-checkbox"]:checked');

                // Get all rating filters the user clicks on
                let ratingCheckBoxes = document.querySelectorAll('input[name="rating-checkbox"]:checked');

                let movieLocationOption = document.querySelector("#movie-location").value;
                console.log(movieLocationOption)

                // Start filtering the data
                output.forEach((record) => {
                  // No filter
                  if (dayCheckBoxes.length == 0 && ratingCheckBoxes.length == 0 && movieLocationOption == "") {
                    // Get the location's latitude and longitude
                    let locationLat = record.location.latitude;
                    let locationLong = record.location.longitude;

                    var newLatLong = new google.maps.LatLng(locationLat, locationLong);

                    // Create a marker for the location
                    var marker = new google.maps.Marker({
                      position: newLatLong,
                      map,
                    });

                    // Tells information about the location
                    let locationContentString = "<h5>" + record.title + "</h5><b><u>Movie Rating:</u></b> " + record.rating + "<br><br><b><u>When:</u></b> " + record.date.substring(0, 10) + "<br><br><b><u>Place:</u></b> " + record.park + "<br><b><u>Address:</u></b> " + record.park_address + "<br><b><u>Phone Number:</u></b> " + record.park_phone;
                    // //TEST HERE
                    // document.querySelector(".movie-container-filter-results").append(locationContentString);

                    // Create the info window, setting the content to the locationContentString
                    var infowindow = new google.maps.InfoWindow({
                      content: locationContentString,
                    });

                    // User clicks on the marker to view content
                    marker.addListener("click", (event) => {
                      infowindow.open({
                        anchor: marker,
                        map,
                        shouldFocus: false,
                      });
                    })

                    // Store the marker
                    markers.push(marker)

                  }  // Only day filter
                  else if (dayCheckBoxes.length != 0 && ratingCheckBoxes.length == 0 && movieLocationOption == "") {
                    dayCheckBoxes.forEach((dayBox) => {
                      if (record.day == dayBox.value) {
                        // Create a marker
                        // Get the location's latitude and longitude
                        let locationLat = record.location.latitude;
                        let locationLong = record.location.longitude;

                        var newLatLong = new google.maps.LatLng(locationLat, locationLong);

                        // Create a marker for the location
                        var marker = new google.maps.Marker({
                          position: newLatLong,
                          map,
                        });

                        // Tells information about the location
                        let locationContentString = "<h5>" + record.title + "</h5><b><u>Movie Rating:</u></b> " + record.rating + "<br><br><b><u>When:</u></b> " + record.date.substring(0, 10) + "<br><br><b><u>Place:</u></b> " + record.park + "<br><b><u>Address:</u></b> " + record.park_address + "<br><b><u>Phone Number:</u></b> " + record.park_phone;

                        // Create the info window, setting the content to the locationContentString
                        var infowindow = new google.maps.InfoWindow({
                          content: locationContentString,
                        });

                        // User clicks on the marker to view content
                        marker.addListener("click", (event) => {
                          infowindow.open({
                            anchor: marker,
                            map,
                            shouldFocus: false,
                          });
                        })

                        // Store the marker
                        markers.push(marker)
                      }
                    })
                  }  // Only rating filter
                  else if (dayCheckBoxes.length == 0 && ratingCheckBoxes.length != 0 && movieLocationOption == "") {
                    ratingCheckBoxes.forEach((ratingBox) => {
                      if (record.rating == ratingBox.value) {
                        // Create a marker
                        // Get the location's latitude and longitude
                        let locationLat = record.location.latitude;
                        let locationLong = record.location.longitude;

                        var newLatLong = new google.maps.LatLng(locationLat, locationLong);

                        // Create a marker for the location
                        var marker = new google.maps.Marker({
                          position: newLatLong,
                          map,
                        });

                        // Tells information about the location
                        let locationContentString = "<h5>" + record.title + "</h5><b><u>Movie Rating:</u></b> " + record.rating + "<br><br><b><u>When:</u></b> " + record.date.substring(0, 10) + "<br><br><b><u>Place:</u></b> " + record.park + "<br><b><u>Address:</u></b> " + record.park_address + "<br><b><u>Phone Number:</u></b> " + record.park_phone;

                        // Create the info window, setting the content to the locationContentString
                        var infowindow = new google.maps.InfoWindow({
                          content: locationContentString,
                        });

                        // User clicks on the marker to view content
                        marker.addListener("click", (event) => {
                          infowindow.open({
                            anchor: marker,
                            map,
                            shouldFocus: false,
                          });
                        })

                        // Store the marker
                        markers.push(marker)
                      }
                    })

                  }  // Both day and rating filters
                  else if (dayCheckBoxes.length != 0 && ratingCheckBoxes.length != 0 && movieLocationOption == "") {
                    dayCheckBoxes.forEach((dayBox) => {
                      ratingCheckBoxes.forEach((ratingBox) => {
                        if (record.day == dayBox.value && record.rating == ratingBox.value) {
                          // Get the location's latitude and longitude
                          let locationLat = record.location.latitude;
                          let locationLong = record.location.longitude;

                          var newLatLong = new google.maps.LatLng(locationLat, locationLong);

                          // Create a marker for the location
                          var marker = new google.maps.Marker({
                            position: newLatLong,
                            map,
                          });

                          // Tells information about the location
                          let locationContentString = "<h5>" + record.title + "</h5><b><u>Movie Rating:</u></b> " + record.rating + "<br><br><b><u>When:</u></b> " + record.date.substring(0, 10) + "<br><br><b><u>Place:</u></b> " + record.park + "<br><b><u>Address:</u></b> " + record.park_address + "<br><b><u>Phone Number:</u></b> " + record.park_phone;

                          // Create the info window, setting the content to the locationContentString
                          var infowindow = new google.maps.InfoWindow({
                            content: locationContentString,
                          });

                          // User clicks on the marker to view content
                          marker.addListener("click", (event) => {
                            infowindow.open({
                              anchor: marker,
                              map,
                              shouldFocus: false,
                            });
                          })

                          // Store the marker
                          markers.push(marker)
                        }
                      })
                    })
                  }  // Only the movie location filter
                  else if (dayCheckBoxes.length == 0 && ratingCheckBoxes.length == 0 && movieLocationOption == record.park) {
                    // Get the location's latitude and longitude
                    let locationLat = record.location.latitude;
                    let locationLong = record.location.longitude;

                    var newLatLong = new google.maps.LatLng(locationLat, locationLong);

                    // Create a marker for the location
                    var marker = new google.maps.Marker({
                      position: newLatLong,
                      map,
                    });

                    // Tells information about the location
                    let locationContentString = "<h5>" + record.title + "</h5><b><u>Movie Rating:</u></b> " + record.rating + "<br><br><b><u>When:</u></b> " + record.date.substring(0, 10) + "<br><br><b><u>Place:</u></b> " + record.park + "<br><b><u>Address:</u></b> " + record.park_address + "<br><b><u>Phone Number:</u></b> " + record.park_phone;

                    // Create the info window, setting the content to the locationContentString
                    var infowindow = new google.maps.InfoWindow({
                      content: locationContentString,
                    });

                    // User clicks on the marker to view content
                    marker.addListener("click", (event) => {
                      infowindow.open({
                        anchor: marker,
                        map,
                        shouldFocus: false,
                      });
                    })

                    // Store the marker
                    markers.push(marker)


                  } // Rating and movie location filters
                  else if (dayCheckBoxes.length == 0 && ratingCheckBoxes.length != 0 && movieLocationOption == record.park) {
                    ratingCheckBoxes.forEach((ratingBox) => {
                      if (record.rating == ratingBox.value) {
                        // Create a marker
                        // Get the location's latitude and longitude
                        let locationLat = record.location.latitude;
                        let locationLong = record.location.longitude;

                        var newLatLong = new google.maps.LatLng(locationLat, locationLong);

                        // Create a marker for the location
                        var marker = new google.maps.Marker({
                          position: newLatLong,
                          map,
                        });

                        // Tells information about the location
                        let locationContentString = "<h5>" + record.title + "</h5><b><u>Movie Rating:</u></b> " + record.rating + "<br><br><b><u>When:</u></b> " + record.date.substring(0, 10) + "<br><br><b><u>Place:</u></b> " + record.park + "<br><b><u>Address:</u></b> " + record.park_address + "<br><b><u>Phone Number:</u></b> " + record.park_phone;

                        // Create the info window, setting the content to the locationContentString
                        var infowindow = new google.maps.InfoWindow({
                          content: locationContentString,
                        });

                        // User clicks on the marker to view content
                        marker.addListener("click", (event) => {
                          infowindow.open({
                            anchor: marker,
                            map,
                            shouldFocus: false,
                          });
                        })

                        // Store the marker
                        markers.push(marker)
                      }
                    })
                  } // Day and movie location filters
                  else if (dayCheckBoxes.length != 0 && ratingCheckBoxes.length == 0 && movieLocationOption == record.park) {
                    dayCheckBoxes.forEach((dayBox) => {
                      if (record.day == dayBox.value) {
                        // Create a marker
                        // Get the location's latitude and longitude
                        let locationLat = record.location.latitude;
                        let locationLong = record.location.longitude;

                        var newLatLong = new google.maps.LatLng(locationLat, locationLong);

                        // Create a marker for the location
                        var marker = new google.maps.Marker({
                          position: newLatLong,
                          map,
                        });

                        // Tells information about the location
                        let locationContentString = "<h5>" + record.title + "</h5><b><u>Movie Rating:</u></b> " + record.rating + "<br><br><b><u>When:</u></b> " + record.date.substring(0, 10) + "<br><br><b><u>Place:</u></b> " + record.park + "<br><b><u>Address:</u></b> " + record.park_address + "<br><b><u>Phone Number:</u></b> " + record.park_phone;

                        // Create the info window, setting the content to the locationContentString
                        var infowindow = new google.maps.InfoWindow({
                          content: locationContentString,
                        });

                        // User clicks on the marker to view content
                        marker.addListener("click", (event) => {
                          infowindow.open({
                            anchor: marker,
                            map,
                            shouldFocus: false,
                          });
                        })

                        // Store the marker
                        markers.push(marker)
                      }
                    })

                  }  // All three filters
                  else if (dayCheckBoxes.length != 0 && ratingCheckBoxes.length != 0 && movieLocationOption == record.park) {
                    dayCheckBoxes.forEach((dayBox) => {
                      ratingCheckBoxes.forEach((ratingBox) => {
                        if (record.day == dayBox.value && record.rating == ratingBox.value) {
                          // Get the location's latitude and longitude
                          let locationLat = record.location.latitude;
                          let locationLong = record.location.longitude;

                          var newLatLong = new google.maps.LatLng(locationLat, locationLong);

                          // Create a marker for the location
                          var marker = new google.maps.Marker({
                            position: newLatLong,
                            map,
                          });

                          // Tells information about the location
                          let locationContentString = "<h5>" + record.title + "</h5><b><u>Movie Rating:</u></b> " + record.rating + "<br><br><b><u>When:</u></b> " + record.date.substring(0, 10) + "<br><br><b><u>Place:</u></b> " + record.park + "<br><b><u>Address:</u></b> " + record.park_address + "<br><b><u>Phone Number:</u></b> " + record.park_phone;

                          // Create the info window, setting the content to the locationContentString
                          var infowindow = new google.maps.InfoWindow({
                            content: locationContentString,
                          });

                          // User clicks on the marker to view content
                          marker.addListener("click", (event) => {
                            infowindow.open({
                              anchor: marker,
                              map,
                              shouldFocus: false,
                            });
                          })

                          // Store the marker
                          markers.push(marker)
                        }
                      })
                    })

                  }


                })

              })

            })

        }

        // Executes the initMap function, in order to display the map
        window.initMap = initMap;
      </script>
    </main>

    <!--   HIDDEN SCREEN: Review Entry Detail Screen   -->
    <main id="div5" class="screen main-content" style="display:none;">

      <article id="review-content" style="padding:10px;">
        <center style="background-color: lightblue;">
          <h1 style="font-family: 'Courier New', Courier, monospace; font-weight:bold;">USER REVIEW</h1>
        </center>
        <button class="mdc-icon-button material-icons back-button">
            <div class="mdc-icon-button__ripple"></div>
            arrow_back
          </button>
        <div class="user-review-content">
          <u>
            <h1 class="user-name"></h1>
          </u>
          <p class="user-body"></p>
        </div>
      </article>

    </main>
  </div>

  <script src="final.js"></script>
  <script src="chicagoArticles.js"></script>
  <script src="displayFilter.js"></script>
  <script src="database.js"></script>
</body>

</html>